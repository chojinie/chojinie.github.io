---
title: YOLO로 Human detector 구성하기.
date: 2024-11-18
tags: [project, yolo]
categories: [project]
author : <jincho>
description : yolo로 많은 사람 탐색하기.
related_posts: True
image:
  path: /assets/img/ultralytics.png
  alt: yolo_homepage
---

## YOLO를 사용해보자.

진행하고 있는 프로젝트에서 하나의 이미지나 동영상의 scene에서 다수의 사람을 찾아서 정보를 처리해야할 일이 생겼다.
기존에 사용하고 있던 detectron이나 YOLO의 기본 세팅으로는 한 이미지에서 2명에서 최대 20명 정도가 찾을 수 있었는데, 이제는 최소 50명 최대 100명 가량을 찾아야 한다.

![Desktip View](/assets/img/multi_person.jpg){: .small} 

### YOLO 공식 홈페이지의 예시를 참고한다.

<a href="https://docs.ultralytics.com/models/yolo11/#supported-tasks-and-modes" style="color: blue; text-decoration: underline;">ultralytics homepage</a>
![Desktip View](/assets/img/ultralytics.png){: .small}

{% raw %}
```python
from ultralytics import YOLO

# Load a model
model = YOLO("yolo11n.pt")  # load an official model

# Predict with the model
results = model("https://ultralytics.com/images/bus.jpg")  # predict on an image

{% endraw %}

nano model을 가져와서 결과를 출력하는 코드이다.

results라는 결과를 print 해보면, 예측에 걸리는 시간, 검출된 객체에 대한 class 정보, bbox 정보 등이 캡슐화되어 출력된다.
난 사람만 찾으면 되므로 아래와 같이 코드를 변형해본다.

```
    def human_detector(self):
        bboxes = []
        # model load.    
        results = self.model.predict(self.image, conf=0.01)    
    
        # detect only human : cls only 0
        for result in results:
            
            # print(type(result.boxes.cls))   # <class 'torch.Tensor'>
            
            cls_array = result.boxes.cls.cpu().numpy()
            
            # cls 가 0인 인덱스 가져오기
            human_indices = np.where(cls_array == 0)[0] # type : ndarray
                        
            if len(human_indices) > 0:
                # cls가 0인 boxes만 선택하여 추가.
                human_boxes = result.boxes[human_indices].xyxy.cpu().numpy()
                bboxes.append(human_boxes)
                print(f'Number of detected persons : {len(bboxes[0])}')   
                
                if self.draw:
                    img = Image.open(self.image).convert("RGB")
                    self.draw_bbox(img, human_boxes, output_dir=self.output_dir)
                           
        return bboxes
```


#
